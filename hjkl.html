<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Visual Effects Lab</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* --- Your original styles --- */
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    background-color: #181313;
    background-image: linear-gradient(310deg ,#093240 10%, #b1d1b1 30%, #b955a0 200%);
    color: #d4d4d4;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 20px;
    min-height: 100vh;
    box-sizing: border-box;
}
main {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    justify-content: center;
    align-items: flex-start;
}
canvas {
    background-color: rgb(202, 169, 169);
    border: 2px solid #444;
    border-radius: 8px;
    max-width: 100%;
    height: auto;
}
.controls-panel {
    background-color: #746565;
    padding: 20px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 300px;
}
button {
    padding: 10px 15px;
    font-size: 0.9em;
    cursor: pointer;
    border-radius: 5px;
    border: none;
    background-color: #007acc;
    color: white;
}
button:hover { background-color: #0099e6; }
button:disabled { background-color: #555; cursor: not-allowed; }
.hidden { display: none; }
.record-controls {
    margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;
}
</style>
</head>
<body>
<h1>Live Visual Effects Lab</h1>
<main>
    <div class="video-container">
        <video id="video" playsinline class="hidden"></video>
        <canvas id="canvas"></canvas>
        <div class="record-controls">
            <button id="startButton">Start Camera</button>
            <button id="switchCam" disabled>Switch Camera</button>
            <button id="recordButton" disabled>Start Recording</button>
            <button id="stopButton" disabled>Stop Recording</button>
            <button id="downloadButton" class="hidden">Download Video</button>
        </div>
    </div>
    <div class="controls-panel">
        <!-- Keep your effect controls here (unchanged from original) -->
        <!-- Example: -->
        <div class="effect-group">
            <input type="checkbox" id="ditherEnable">
            <label>Dithering</label>
        </div>
        <!-- Add other effect controls from your original file -->
    </div>
</main>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const startButton = document.getElementById('startButton');
const switchCamButton = document.getElementById('switchCam');
const recordButton = document.getElementById('recordButton');
const stopButton = document.getElementById('stopButton');
const downloadButton = document.getElementById('downloadButton');

let useFront = true; 
let currentStream;
let mediaRecorder, recordedChunks = [];

// Start camera with facing mode
async function startCamera() {
    if (currentStream) currentStream.getTracks().forEach(track => track.stop());
    try {
        const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: useFront ? "user" : "environment" },
            audio: false
        });
        currentStream = stream;
        video.srcObject = stream;
        await video.play();
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        startButton.disabled = true;
        switchCamButton.disabled = false;
        recordButton.disabled = false;
        mainLoop();
    } catch (err) {
        alert("Could not access camera: " + err.message);
    }
}

// Main drawing loop
function mainLoop() {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    // Apply your effects here...
    requestAnimationFrame(mainLoop);
}

// Switch between cameras
switchCamButton.addEventListener('click', () => {
    useFront = !useFront;
    startCamera();
});

// Recording functions
recordButton.addEventListener('click', () => {
    const stream = canvas.captureStream(30);
    mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
    recordedChunks = [];
    mediaRecorder.ondataavailable = e => e.data.size && recordedChunks.push(e.data);
    mediaRecorder.start();
    recordButton.disabled = true;
    stopButton.disabled = false;
});
stopButton.addEventListener('click', () => {
    mediaRecorder.stop();
    recordButton.disabled = false;
    stopButton.disabled = true;
    downloadButton.classList.remove('hidden');
});
downloadButton.addEventListener('click', () => {
    const blob = new Blob(recordedChunks, { type: 'video/webm' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "recorded-video.webm";
    a.click();
    URL.revokeObjectURL(url);
});

// Start camera on button click
startButton.addEventListener('click', startCamera);
</script>
</body>
</html>
